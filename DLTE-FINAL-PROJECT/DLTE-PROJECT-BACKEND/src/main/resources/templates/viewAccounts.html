
<!--<!DOCTYPE html>-->
<!--<html lang="en" xmlns:th="http://www.thymeleaf.org">-->
<!--<head>-->

<!--    <meta charset="UTF-8">-->
<!--    <title>Dashboard</title>-->
<!--    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjIcsSv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">-->
<!--    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>-->
<!--    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>-->
<!--        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>-->
<!--    <style>-->
<!--        /*.navbar {*/-->
<!--        /*    margin-bottom: 20px; !* Add margin between navbar and carousel *!*/-->
<!--        /*}*/-->
<!--        .carousel{-->
<!--            margin-top: 20px;-->
<!--        }-->
<!--        footer {-->
<!--            padding-top: 20px; /* Add padding between carousel and footer */-->
<!--        }-->
<!--    </style>-->
<!--</head>-->

<!--<body>-->
<!--<header th:insert="header :: head"></header>-->
<!--<div class="container">-->
<!--    <h1>Fetch Account Details</h1>-->
<!--    <div id="accountDetails" class="mt-3"></div>-->
<!--    <div id="errorMessage" class="alert alert-danger mt-3 d-none"></div>-->
<!--</div>-->
<!--<footer th:insert="footer :: foot"></footer>-->
<!--</body>-->
<!--<script>-->
<!--    $(document).ready(function() {-->
<!--        // Function to fetch active accounts when button is clicked-->
<!--        //$("#fetchAccounts").click(function() {-->
<!--            // Retrieve customer ID from input field-->
<!--            var customerId = $("#customerId").val();-->

<!--            // Retrieve stored credentials from sessionStorage-->
<!--            var credentials = sessionStorage.getItem("logged");-->

<!--            // Construct SOAP request-->
<!--            var soapRequest = `<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:acc="http://accounts.services">-->
<!--            <soapenv:Header/>-->
<!--            <soapenv:Body>-->
<!--                <acc:filterByStatusRequest>-->
<!--                    <acc:customerId>${customerId}</acc:customerId>-->
<!--                </acc:filterByStatusRequest>-->
<!--            </soapenv:Body>-->
<!--            </soapenv:Envelope>`;-->

<!--            // Make AJAX call to SOAP service-->
<!--            $.ajax({-->
<!--                url: "http://localhost:8082/accountsrepo/accounts.wsdl",-->
<!--                type: "POST",-->
<!--                dataType:"xml",-->
<!--                beforeSend:function(handler){-->
<!--                    // handler.setRequestHeader("Authorization","Basic " + btoa("rakesh:rakesh"))-->
<!--                    //handler.setRequestHeader("Authorization","Basic "+sessionStorage.getItem("logged"))-->
<!--                    handler.setRequestHeader("Authorization", "Basic " + credentials);-->
<!--                    //handler.setRequestHeader("SOAPAction","filterByStatusRequest")-->
<!--                },-->
<!--                contentType:"text/xml;charset=utf-8",-->
<!--                data:soapRequest,-->
<!--                success: function(response) {-->
<!--                    // Parse response to extract account details-->
<!--                    var accounts = $(response).find("ns2\\:accounts");-->

<!--                    // Initialize HTML content for displaying account details-->
<!--                    var accountDetailsHTML = "<h2>Active Accounts</h2>";-->

<!--                    // Iterate through each account-->
<!--                    accounts.each(function() {-->
<!--                        var accountId = $(this).find("ns2\\:accountId").text();-->
<!--                        var accountNumber = $(this).find("ns2\\:accountNumber").text();-->
<!--                        var customerId = $(this).find("ns2\\:customerId").text();-->
<!--                        var accountType = $(this).find("ns2\\:accountType").text();-->
<!--                        var accountStatus = $(this).find("ns2\\:accountStatus").text();-->
<!--                        var accountBalance = $(this).find("ns2\\:accountBalance").text();-->

<!--                        // Construct HTML for each account-->
<!--                        var accountHTML = `-->
<!--                            <div class="card mt-3">-->
<!--                                <div class="card-body">-->
<!--                                    <p class="card-text">Account ID: ${accountId}</p>-->
<!--                                    <p class="card-text">Account Number: ${accountNumber}</p>-->
<!--                                    <p class="card-text">Customer ID: ${customerId}</p>-->
<!--                                    <p class="card-text">Account Type: ${accountType}</p>-->
<!--                                    <p class="card-text">Account Status: ${accountStatus}</p>-->
<!--                                    <p class="card-text">Account Balance: ${accountBalance}</p>-->
<!--                                </div>-->
<!--                            </div>-->
<!--                        `;-->

<!--                        // Append account HTML to the overall account details HTML-->
<!--                        accountDetailsHTML += accountHTML;-->
<!--                    });-->

<!--                    // Display active accounts in HTML-->
<!--                    $("#accountDetails").html(accountDetailsHTML);-->
<!--                    // Hide error message if previously shown-->
<!--                    $("#errorMessage").addClass("d-none");-->
<!--                    const info = $(response).find(`ns2\\:serviceStatus`).text()-->
<!--                    alert(info)-->
<!--                },-->
<!--                // error: function(xhr, status, error) {-->
<!--                //     // Display error message-->
<!--                //     $("#errorMessage").removeClass("d-none").text("An error occurred while fetching active accounts.");-->
<!--                // }-->
<!--            });-->
<!--        });-->
<!--   // });-->
<!--</script>-->
<!--</html>-->


<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjIcsSv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <style>
        .carousel {
            margin-top: 20px;
        }
        footer {
            padding-top: 20px;
        }
        .card2 {
            background-color: #182052;
            color: white;
            border-radius: 20px;
            width: 45%; /* Adjust the width as needed */
            margin-right: 25px; /* Add space between cards */
            margin-bottom: 10px; /* Add space between rows */
            display: inline-block; /* Display cards inline */
        }

        .card-text {
            color: white; /* Set text color to white */
        }

        .pagination {
            display: flex;
            justify-content: center;
        }
    </style>
</head>
<body>
<header th:insert="header :: head"></header>
<div class="container">
    <div id="accountDetails" class="mt-3"></div>
    <div id="pagination" class="mt-3"></div>
    <div id="errorMessage" class="alert alert-danger mt-3 d-none"></div>
</div>
<footer th:insert="footer :: foot"></footer>
</body>
<script>
    let currentPage = 1;
    const itemsPerPage = 2;

    // Function to change the current page
    function changePage(page) {
        currentPage = page;
        fetchActiveAccounts();
    }

    // Function to fetch active accounts
    function fetchActiveAccounts() {
        // Retrieve stored credentials from sessionStorage
        var credentials = sessionStorage.getItem("logged");

        // Construct SOAP request
        var soapRequest = `<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:acc="http://accounts.services">
            <soapenv:Header/>
            <soapenv:Body>
                <acc:filterByStatusRequest>
                    <!-- Provide necessary parameters for filtering -->
        </acc:filterByStatusRequest>
        </soapenv:Body>
        </soapenv:Envelope>`;

            // Make AJAX call to SOAP service
        $.ajax({
        url: "http://localhost:8082/accountsrepo/accounts.wsdl",
        type: "POST",
        dataType: "xml",
        beforeSend: function(handler) {
        handler.setRequestHeader("Authorization", "Basic " + credentials);
        },
        contentType: "text/xml;charset=utf-8",
        data: soapRequest,
        success: function(response) {
            // Parse response to extract account details
        var accounts = $(response).find("ns2\\:accounts");


            if (accounts.length === 0) {
                // Retrieve the SOAP response content
                var soapResponseContent = new XMLSerializer().serializeToString(response);
                // Redirect to the error page with the SOAP response content as a query parameter
                window.location.href = "error-page.html?message=No%20active%20accounts%20found&soapResponse=" + encodeURIComponent(soapResponseContent);
                return;
            }







            // Initialize HTML content for displaying account details
        var accountDetailsHTML = "<h2>Active Accounts</h2>";

            // Calculate the start and end indices for the current page
        var startIndex = (currentPage - 1) * itemsPerPage;
        var endIndex = startIndex + itemsPerPage;

            // Iterate through each account
        accounts.each(function(index) {
        if (index >= startIndex && index < endIndex) {
        var accountId = $(this).find("ns2\\:accountId").text();
        var accountNumber = $(this).find("ns2\\:accountNumber").text();
        var customerId = $(this).find("ns2\\:customerId").text();
        var accountType = $(this).find("ns2\\:accountType").text();
        var accountStatus = $(this).find("ns2\\:accountStatus").text();
        var accountBalance = $(this).find("ns2\\:accountBalance").text();

            // Construct HTML for each account
        var accountHTML = `
                            <div class="card2 mt-3">
                                <div class="card-body">
                                    <p class="card-text">Account ID: ${accountId}</p>
                                    <p class="card-text">Account Number: ${accountNumber}</p>
                                    <p class="card-text">Customer ID: ${customerId}</p>
                                    <p class="card-text">Account Type: ${accountType}</p>
                                    <p class="card-text">Account Status: ${accountStatus}</p>
                                    <p class="card-text">Account Balance: ${accountBalance}</p>
                                </div>
                            </div>
                        `;
        // Append account HTML to the overall account details HTML
    accountDetailsHTML += accountHTML;
    }
    });

        // Display active accounts in HTML
    $("#accountDetails").html(accountDetailsHTML);

        // Hide error message if previously shown
    $("#errorMessage").addClass("d-none");

        // Render pagination
    renderPagination(accounts.length);
    },
        // Handle errors if needed
    });
    }

    // Function to render pagination controls
    function renderPagination(totalItems) {
        const totalPages = Math.ceil(totalItems / itemsPerPage);
        let paginationHTML = "";
        for (let i = 1; i <= totalPages; i++) {
            const liClass = (i === currentPage) ? "page-item active" : "page-item";
            paginationHTML += `<li class="${liClass}"><button class="page-link" onclick="changePage(${i})">${i}</button></li>`;
        }
        $("#pagination").html(`<nav aria-label="Page navigation"><ul class="pagination">${paginationHTML}</ul></nav>`);
    }

    // Initial fetch of account details
    fetchActiveAccounts();
</script>
</html>

